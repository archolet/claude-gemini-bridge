---
metadata:
  name: enterprise_aria_patterns
  version: "1.0.0"
  description: "Enterprise-grade ARIA patterns for complex UI components (Tier 3-4)"
  author: "Gemini MCP Team"
  tags:
    - segment
    - enterprise
    - aria
    - accessibility
    - a11y

applies_to:
  - architect

priority: high

variables:
  tier: "3"

content: |
  ## ENTERPRISE ARIA PATTERNS (TIER {{tier}}+)

  These patterns are MANDATORY for complex/enterprise components (data grids, tree grids,
  pivot tables, dashboards). They complement basic ARIA with advanced keyboard navigation,
  live regions, and multi-widget coordination.

  ### SEMANTIC HTML REFERENCE TABLE

  | Component | Element | ARIA Role | Critical Attributes |
  |-----------|---------|-----------|---------------------|
  | Data Grid | `div` | `grid` | `aria-rowcount`, `aria-colcount`, `aria-sort` |
  | Tree Grid | `div` | `treegrid` | `aria-expanded`, `aria-level`, `aria-setsize` |
  | Pivot Table | `table` | `grid` | `aria-labelledby`, group headers |
  | Form Builder | `form` | - | `novalidate`, `aria-describedby` |
  | Autocomplete | `div` | `combobox` | `aria-autocomplete`, `aria-activedescendant` |
  | Modal | `dialog`/`div` | `dialog` | `aria-modal`, `aria-labelledby` |
  | Toast | `div` | `alert` | `aria-live="assertive"`, `aria-atomic` |
  | Tab Panel | `div` | `tablist`+`tab`+`tabpanel` | `aria-selected`, `aria-controls` |
  | Menu | `nav>ul` | `menubar`+`menu`+`menuitem` | `aria-haspopup`, `aria-expanded` |
  | Progress | `div` | `progressbar` | `aria-valuenow`, `aria-valuemin`, `aria-valuemax` |
  | Slider | `div` | `slider` | `aria-valuenow`, `aria-valuetext` |
  | Switch | `button` | `switch` | `aria-checked` |

  ### GRID/TABLE MARKUP PATTERN

  For data grids with sorting, filtering, and virtual scrolling:

  ```html
  <div role="grid"
       aria-label="[Grid Name]"
       aria-rowcount="[total_rows]"
       aria-colcount="[total_columns]"
       aria-describedby="grid-instructions">

    <!-- Hidden instructions for screen readers -->
    <div id="grid-instructions" class="sr-only">
      Use arrow keys to navigate cells. Press Enter to edit. Space to select row.
    </div>

    <!-- Header Group -->
    <div role="rowgroup">
      <div role="row" aria-rowindex="1">
        <div role="columnheader"
             aria-colindex="1"
             aria-sort="ascending"
             tabindex="0">
          Column Name
          <span aria-hidden="true">&#9650;</span>
        </div>
        <div role="columnheader"
             aria-colindex="2"
             aria-sort="none"
             tabindex="-1">
          Another Column
        </div>
      </div>
    </div>

    <!-- Body Group -->
    <div role="rowgroup">
      <div role="row"
           aria-rowindex="2"
           aria-selected="false"
           tabindex="-1">
        <div role="gridcell"
             aria-colindex="1"
             tabindex="-1">
          Cell Content
        </div>
        <div role="gridcell"
             aria-colindex="2"
             tabindex="-1">
          Another Cell
        </div>
      </div>
    </div>
  </div>
  ```

  ### VIRTUAL SCROLLING ARIA

  When implementing virtual scrolling (rendering only visible rows):

  ```html
  <!-- Container must maintain full aria-rowcount -->
  <div role="grid" aria-rowcount="10000" aria-colcount="5">

    <!-- Visible rows use correct aria-rowindex (not starting from 1) -->
    <div role="row" aria-rowindex="501">...</div>
    <div role="row" aria-rowindex="502">...</div>
    <div role="row" aria-rowindex="503">...</div>
    <!-- ... only ~20-30 rows rendered at a time -->
  </div>
  ```

  **Rules:**
  - `aria-rowcount` = total data rows (not visible rows)
  - `aria-rowindex` = actual row position in full dataset
  - Update `aria-activedescendant` when scrolling changes active cell

  ### TREE GRID PATTERN

  For hierarchical data (folders, org charts, nested categories):

  ```html
  <div role="treegrid" aria-label="File Browser">
    <div role="row" aria-level="1" aria-setsize="3" aria-posinset="1" aria-expanded="true">
      <div role="gridcell">
        <button aria-label="Collapse Documents folder" aria-expanded="true">
          <span aria-hidden="true">&#x25BC;</span>
        </button>
        Documents
      </div>
    </div>

    <!-- Child rows -->
    <div role="row" aria-level="2" aria-setsize="2" aria-posinset="1">
      <div role="gridcell" style="padding-left: 24px;">
        report.pdf
      </div>
    </div>
  </div>
  ```

  **Required Attributes:**
  - `aria-level`: Nesting depth (1 = root)
  - `aria-setsize`: Number of siblings at same level
  - `aria-posinset`: Position among siblings
  - `aria-expanded`: Only on expandable parent rows

  ### FORM FIELD PATTERN

  For complex forms with validation, hints, and error messages:

  ```html
  <div class="field-group">
    <label for="email" id="email-label">
      Email Address
      <span aria-hidden="true" class="text-red-500">*</span>
    </label>

    <input
      type="email"
      id="email"
      name="email"
      aria-labelledby="email-label"
      aria-describedby="email-hint email-error"
      aria-invalid="false"
      aria-required="true"
      autocomplete="email"
    />

    <span id="email-hint" class="text-sm text-slate-500">
      We'll never share your email with anyone.
    </span>

    <span id="email-error"
          role="alert"
          aria-live="polite"
          class="text-sm text-red-600 hidden">
      <!-- Error message injected here -->
    </span>
  </div>
  ```

  **Validation State Changes:**
  ```html
  <!-- Invalid state -->
  <input aria-invalid="true" aria-describedby="email-hint email-error">
  <span id="email-error" role="alert" class="text-red-600">
    Please enter a valid email address.
  </span>
  ```

  ### LIVE REGION PATTERNS

  For dynamic content updates that screen readers should announce:

  ```html
  <!-- Status announcements (non-urgent) -->
  <div aria-live="polite"
       aria-atomic="true"
       class="sr-only"
       id="status-region">
    <!-- "Saving...", "3 items selected", "Page 2 of 10" -->
  </div>

  <!-- Error announcements (urgent, interrupts) -->
  <div aria-live="assertive"
       aria-atomic="true"
       class="sr-only"
       id="error-region">
    <!-- "Connection lost", "Invalid credentials" -->
  </div>

  <!-- Log-style updates (append-only) -->
  <div aria-live="polite"
       aria-atomic="false"
       aria-relevant="additions"
       id="activity-log">
    <!-- Chat messages, notifications -->
  </div>
  ```

  **When to use each:**
  | Type | aria-live | aria-atomic | Use Case |
  |------|-----------|-------------|----------|
  | Status | polite | true | Loading states, selection counts |
  | Error | assertive | true | Form errors, connection issues |
  | Log | polite | false | Chat, activity feed |
  | Timer | off | - | Countdown (too frequent) |

  ### ROVING TABINDEX VS ARIA-ACTIVEDESCENDANT

  **Use Roving Tabindex when:**
  - Component is simple (tabs, radio group, toolbar)
  - Natural DOM focus behavior is acceptable
  - No virtual scrolling

  ```html
  <!-- Roving tabindex: Active item has tabindex="0", others have tabindex="-1" -->
  <div role="tablist">
    <button role="tab" tabindex="0" aria-selected="true">Tab 1</button>
    <button role="tab" tabindex="-1" aria-selected="false">Tab 2</button>
    <button role="tab" tabindex="-1" aria-selected="false">Tab 3</button>
  </div>
  ```

  **Use aria-activedescendant when:**
  - Component is complex (data grid, tree, combobox)
  - Virtual scrolling is used (active element may not be in DOM)
  - Need to maintain focus on container

  ```html
  <!-- aria-activedescendant: Container holds focus, tracks active item by ID -->
  <div role="listbox"
       tabindex="0"
       aria-activedescendant="option-2"
       @keydown="handleNavigation">
    <div role="option" id="option-1">Item 1</div>
    <div role="option" id="option-2" aria-selected="true">Item 2</div>
    <div role="option" id="option-3">Item 3</div>
  </div>
  ```

  ### COMBOBOX PATTERN (Autocomplete)

  For search inputs with dynamic suggestions:

  ```html
  <div class="relative">
    <label for="city-search" id="city-label">City</label>

    <input type="text"
           id="city-search"
           role="combobox"
           aria-autocomplete="list"
           aria-controls="city-listbox"
           aria-expanded="true"
           aria-activedescendant="city-option-2"
           aria-labelledby="city-label">

    <ul role="listbox"
        id="city-listbox"
        aria-label="City suggestions">
      <li role="option" id="city-option-1">New York</li>
      <li role="option" id="city-option-2" aria-selected="true">Los Angeles</li>
      <li role="option" id="city-option-3">Chicago</li>
    </ul>
  </div>
  ```

  ### DIALOG/MODAL PATTERN

  ```html
  <div role="dialog"
       aria-modal="true"
       aria-labelledby="dialog-title"
       aria-describedby="dialog-desc"
       tabindex="-1">

    <h2 id="dialog-title">Confirm Deletion</h2>
    <p id="dialog-desc">This action cannot be undone.</p>

    <button>Cancel</button>
    <button>Delete</button>
  </div>
  ```

  **Requirements:**
  - Focus trap: Tab cycles within modal
  - Escape closes modal
  - Return focus to trigger element on close
  - `aria-modal="true"` hides background from AT

  ### ANTI-PATTERNS (FORBIDDEN)

  - `tabindex > 0` - Disrupts natural tab order
  - `<div onclick>` without `role` and `tabindex` - Not accessible
  - `outline: none` without alternative focus indicator
  - `aria-expanded` on leaf nodes (non-expandable items)
  - Placeholder text as only label
  - `aria-hidden="true"` on focusable elements
  - Missing `aria-label` on icon-only buttons
  - `role="button"` without keyboard handler

  ### TOAST/NOTIFICATION PATTERN

  For non-modal alerts that appear temporarily:

  ```html
  <!-- Toast Container (fixed position) -->
  <div id="toast-container"
       class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"
       aria-live="polite"
       aria-label="Notifications">

    <!-- Individual Toast -->
    <div role="alert"
         aria-atomic="true"
         class="flex items-center gap-3 px-4 py-3 bg-white rounded-lg shadow-lg border">

      <!-- Icon (decorative) -->
      <svg aria-hidden="true" class="w-5 h-5 text-emerald-500">...</svg>

      <!-- Message -->
      <p class="text-sm text-slate-700">Changes saved successfully</p>

      <!-- Dismiss Button -->
      <button type="button"
              aria-label="Dismiss notification"
              class="ml-auto p-1 hover:bg-slate-100 rounded">
        <svg aria-hidden="true" class="w-4 h-4">...</svg>
      </button>
    </div>
  </div>
  ```

  **Toast Types and ARIA:**
  | Type | role | aria-live | Color |
  |------|------|-----------|-------|
  | Success | status | polite | emerald |
  | Info | status | polite | blue |
  | Warning | alert | polite | amber |
  | Error | alert | assertive | rose |

  **Auto-dismiss Accessibility:**
  - Minimum display time: 5 seconds
  - Pause timer on hover/focus
  - Include manual dismiss for all toasts
  - Never auto-dismiss error toasts

  ### PROGRESS BAR PATTERN

  For determinate and indeterminate progress:

  ```html
  <!-- Determinate Progress -->
  <div class="w-full">
    <div class="flex justify-between mb-1">
      <span id="progress-label" class="text-sm font-medium text-slate-700">
        Uploading files...
      </span>
      <span aria-hidden="true" class="text-sm text-slate-500">75%</span>
    </div>

    <div role="progressbar"
         aria-labelledby="progress-label"
         aria-valuenow="75"
         aria-valuemin="0"
         aria-valuemax="100"
         aria-valuetext="75 percent complete"
         class="h-2 bg-slate-200 rounded-full overflow-hidden">
      <div class="h-full bg-blue-600 transition-all duration-300"
           style="width: 75%">
      </div>
    </div>
  </div>

  <!-- Indeterminate Progress (loading) -->
  <div role="progressbar"
       aria-label="Loading content"
       aria-busy="true"
       class="h-1 bg-slate-200 rounded-full overflow-hidden">
    <div class="h-full w-1/3 bg-blue-600 animate-[shimmer_1.5s_ease-in-out_infinite]">
    </div>
  </div>
  ```

  **Progress State Updates:**
  ```javascript
  // Update progress with screen reader announcement
  function updateProgress(value, max, label) {
    const progressbar = document.getElementById('progress');
    progressbar.setAttribute('aria-valuenow', value);
    progressbar.setAttribute('aria-valuetext', `${Math.round((value/max)*100)} percent ${label}`);

    // Announce milestones (25%, 50%, 75%, 100%)
    if ([25, 50, 75, 100].includes(Math.round((value/max)*100))) {
      announceToScreenReader(`${label}: ${Math.round((value/max)*100)} percent complete`);
    }
  }
  ```

  ### SWITCH/TOGGLE PATTERN

  For binary on/off controls:

  ```html
  <button role="switch"
          aria-checked="false"
          aria-labelledby="dark-mode-label"
          class="relative w-11 h-6 rounded-full bg-slate-200
                 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
          @click="toggle()"
          @keydown.space.prevent="toggle()">

    <span id="dark-mode-label" class="sr-only">Dark mode</span>

    <!-- Track (background changes based on state) -->
    <span aria-hidden="true"
          class="absolute inset-0 rounded-full transition-colors"
          :class="isOn ? 'bg-blue-600' : 'bg-slate-200'">
    </span>

    <!-- Thumb -->
    <span aria-hidden="true"
          class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow
                 transition-transform"
          :class="isOn ? 'translate-x-5' : 'translate-x-0'">
    </span>
  </button>

  <!-- Associated label (clickable) -->
  <label id="dark-mode-label"
         for="dark-mode-switch"
         class="text-sm font-medium text-slate-700 cursor-pointer">
    Dark mode
  </label>
  ```

  **Key Requirements:**
  - `role="switch"` (not checkbox)
  - `aria-checked="true/false"`
  - Click AND Space/Enter activation
  - Visible focus indicator

  ### SLIDER PATTERN

  For range inputs with custom styling:

  ```html
  <div class="w-full">
    <div class="flex justify-between mb-2">
      <label id="volume-label" class="text-sm font-medium text-slate-700">
        Volume
      </label>
      <span id="volume-value" class="text-sm text-slate-500">50%</span>
    </div>

    <div role="slider"
         tabindex="0"
         aria-labelledby="volume-label"
         aria-valuemin="0"
         aria-valuemax="100"
         aria-valuenow="50"
         aria-valuetext="50 percent"
         class="relative h-2 bg-slate-200 rounded-full cursor-pointer
                focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
         @keydown.left="decrease()"
         @keydown.right="increase()"
         @keydown.home="setMin()"
         @keydown.end="setMax()">

      <!-- Filled Track -->
      <div aria-hidden="true"
           class="absolute h-full bg-blue-600 rounded-full"
           style="width: 50%">
      </div>

      <!-- Thumb -->
      <div aria-hidden="true"
           class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-4 h-4
                  bg-white border-2 border-blue-600 rounded-full shadow"
           style="left: 50%">
      </div>
    </div>
  </div>
  ```

  **Keyboard Shortcuts:**
  | Key | Action |
  |-----|--------|
  | Left/Down Arrow | Decrease by 1 |
  | Right/Up Arrow | Increase by 1 |
  | Page Down | Decrease by 10 |
  | Page Up | Increase by 10 |
  | Home | Set to minimum |
  | End | Set to maximum |

  ### SKIP LINKS

  For complex layouts, provide skip navigation:

  ```html
  <a href="#main-content"
     class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4
            focus:z-50 focus:px-4 focus:py-2 focus:bg-blue-600 focus:text-white">
    Skip to main content
  </a>

  <!-- ... navigation, header, etc. ... -->

  <main id="main-content" tabindex="-1">
    <!-- Main content -->
  </main>
  ```
